apiVersion: v1
kind: ConfigMap
metadata:
  name: vault-templates-authentication
  namespace: shadowchats
  annotations:
    argocd.argoproj.io/sync-wave: "-2"
data:
  authentication-appsettings.json.tpl: |
    {
      "JwtSettings": {
        "SecretKeyBase64": "{{ with secret "secret/authentication" }}{{ .Data.data.jwt_secret }}{{ end }}",
        "Issuer": "Shadowchats",
        "Audience": "ShadowchatsUsers"
      },
      "PostgresConnectionStrings": {
        "ReadWrite": "Host=databases-postgres-pgbouncer-rw.databases.svc.cluster.local;Port=5432;Database=authentication;Username=authentication;Password={{ with secret "secret/authentication" }}{{ .Data.data.postgres_password }}{{ end }}",
        "ReadOnly":  "Host=databases-postgres-pgbouncer-ro.databases.svc.cluster.local;Port=5432;Database=authentication;Username=authentication;Password={{ with secret "secret/authentication" }}{{ .Data.data.postgres_password }}{{ end }}"
      }
    }
