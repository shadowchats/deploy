# Shadowchats.Deploy

ĞœĞ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ñ‹ Kubernetes Ğ¼ĞµÑÑĞµĞ½Ğ´Ğ¶ĞµÑ€Ğ° **Shadowchats**.

## ğŸ“„ License

Shadowchats is free software licensed under the **GNU Affero General Public License v3.0**.

This means you can:
- âœ… Use the software for any purpose
- âœ… Study and modify the source code
- âœ… Distribute the software
- âœ… Distribute your modifications

**Important requirements:**
- ğŸ”’ Any modifications must also be licensed under AGPL v3
- ğŸ“¤ If you run a modified version on a server, you must provide source code to users
- ğŸ“ You must preserve copyright notices and license information

See [LICENSE](LICENSE) for full details.

### Why AGPL v3?
We chose AGPL v3 to ensure that Shadowchats remains free and open source forever, even when used as a network service. This protects users' rights to access, study, and modify the software that handles their private communications.

## ğŸ“„ [COPYRIGHT](COPYRIGHT).

## ğŸ“§ Contact

For questions about licensing or to request source code:
- Email: lenya.dorovskoy@mail.ru
- GitHub repository: https://github.com/0ne290/Shadowchats.Deploy
- Author's GitHub: https://github.com/0ne290

## Ğ”ĞµĞ¿Ğ»Ğ¾Ğ¹

```bash
#!/bin/bash
set -e

echo "ğŸš€ Shadowchats universal deployment"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ namespace Ğ´Ğ»Ñ Shadowchats
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
kubectl apply -f namespace.yaml

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ ÑĞµĞºÑ€ĞµÑ‚ Ğ´Ğ»Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº Docker Registry
# Ğ¸ Ğ¿Ñ€Ğ¸Ğ²ÑĞ·Ñ‹Ğ²Ğ°ĞµĞ¼ ĞµĞ³Ğ¾ Ğº default ServiceAccount
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
kubectl apply -f dockerhub-secret.yaml
kubectl apply -f default-sa.yaml

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğº ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ñƒ
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
kubectl cluster-info

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° CloudNativePG operator (ĞµÑĞ»Ğ¸ ĞµÑ‰Ñ‘ Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if ! kubectl get crd clusters.postgresql.cnpg.io >/dev/null 2>&1; then
    echo "Installing CloudNativePG operator..."
    kubectl apply -f https://raw.githubusercontent.com/cloudnative-pg/cloudnative-pg/release-1.20/releases/cnpg-1.20.0.yaml
    # Ğ–Ğ´ĞµĞ¼, Ğ¿Ğ¾ĞºĞ° Ğ¾Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€ ÑÑ‚Ğ°Ğ½ĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½
    kubectl wait --for=condition=Available deployment/cnpg-controller-manager -n cnpg-system --timeout=600s
fi

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµĞ¼ ÑĞµĞºÑ€ĞµÑ‚Ñ‹ Ğ´Ğ»Ñ Ğ¼Ğ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
kubectl apply -f Shadowchats.Authentication/secret-example.yaml
kubectl apply -f Shadowchats.ApiGateway/secret-example.yaml

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Ğ Ğ°Ğ·Ğ²Ğ¾Ñ€Ğ°Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼ PostgreSQL (CloudNativePG)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
kubectl apply -f Shadowchats.Authentication/postgres.yaml
kubectl wait --for=condition=Ready cluster/authentication-postgres -n shadowchats --timeout=600s

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Ğ Ğ°Ğ·Ğ²Ğ¾Ñ€Ğ°Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼ PgBouncer Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğº Ğ‘Ğ”
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
kubectl apply -f Shadowchats.Authentication/pgbouncer.yaml
kubectl wait --for=condition=Ready pooler/authentication-pgbouncer-rw -n shadowchats --timeout=300s
kubectl wait --for=condition=Ready pooler/authentication-pgbouncer-ro -n shadowchats --timeout=300s

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Ğ Ğ°Ğ·Ğ²Ğ¾Ñ€Ğ°Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ¼Ğ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ Authentication
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
kubectl apply -f Shadowchats.Authentication/deployment.yaml
kubectl apply -f Shadowchats.Authentication/service.yaml
kubectl apply -f Shadowchats.Authentication/hpa.yaml

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Ğ Ğ°Ğ·Ğ²Ğ¾Ñ€Ğ°Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼ API Gateway
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
kubectl apply -f Shadowchats.ApiGateway/deployment.yaml
kubectl apply -f Shadowchats.ApiGateway/service.yaml
kubectl apply -f Shadowchats.ApiGateway/hpa.yaml
kubectl apply -f Shadowchats.ApiGateway/ingress.yaml

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Ğ–Ğ´ĞµĞ¼ Ğ¿Ğ¾ĞºĞ° Ğ²ÑĞµ Ğ´ĞµĞ¿Ğ»Ğ¾Ğ¹Ğ¼ĞµĞ½Ñ‚Ñ‹ ÑÑ‚Ğ°Ğ½ÑƒÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğ¼Ğ¸
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
for deploy in authentication api-gateway; do
    kubectl wait --for=condition=Available deployment/$deploy -n shadowchats --timeout=300s
done

echo "âœ… Deployment completed!"
echo "Check status: kubectl get all -n shadowchats"
```
